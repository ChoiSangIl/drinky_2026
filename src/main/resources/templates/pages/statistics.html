<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/app-base}">
<head>
    <title>í†µê³„</title>
</head>
<body>
<main layout:fragment="content" class="pb-20">
    <header class="px-4 py-6">
        <h1 class="text-xl font-bold text-gray-800">í†µê³„</h1>
        <p class="text-sm text-gray-500">ë‚˜ì˜ ìŒì£¼ ìŠµê´€ì„ í™•ì¸í•˜ì„¸ìš”</p>
    </header>

    <!-- ë°ì´í„° ìˆëŠ” ê²½ìš° -->
    <div th:if="${hasData}">
        <!-- ì¸ì‚¬ì´íŠ¸ ë©”ì‹œì§€ -->
        <section class="px-4 mb-4">
            <div class="bg-emerald-50 rounded-2xl p-4 text-center">
                <p class="text-emerald-700 font-medium" th:text="${insight}">ì¸ì‚¬ì´íŠ¸ ë©”ì‹œì§€</p>
            </div>
        </section>

        <!-- ìš”ì•½ í†µê³„ ì¹´ë“œ -->
        <section class="px-4 mb-6">
            <div class="grid grid-cols-3 gap-3">
                <!-- ì´ë²ˆ ì£¼ -->
                <div class="bg-white rounded-xl p-3 shadow-sm text-center">
                    <p class="text-xs text-gray-500">ì´ë²ˆ ì£¼ ìŒì£¼</p>
                    <p class="text-2xl font-bold text-gray-800" th:text="${stats.thisWeekDrinking + 'ì¼'}">0ì¼</p>
                    <p th:class="${stats.weekChange < 0 ? 'text-emerald-500' : (stats.weekChange > 0 ? 'text-orange-500' : 'text-gray-400')}"
                       class="text-xs mt-1" th:text="${stats.weekTrend}">- ë³€í™” ì—†ìŒ</p>
                </div>
                <!-- ì´ë²ˆ ë‹¬ -->
                <div class="bg-white rounded-xl p-3 shadow-sm text-center">
                    <p class="text-xs text-gray-500">ì´ë²ˆ ë‹¬ ìŒì£¼</p>
                    <p class="text-2xl font-bold text-gray-800" th:text="${stats.thisMonthDrinking + 'ì¼'}">0ì¼</p>
                    <p th:class="${stats.monthChange < 0 ? 'text-emerald-500' : (stats.monthChange > 0 ? 'text-orange-500' : 'text-gray-400')}"
                       class="text-xs mt-1" th:text="${stats.monthTrend}">- ë³€í™” ì—†ìŒ</p>
                </div>
                <!-- ìŠ¤íŠ¸ë¦­ -->
                <div class="bg-white rounded-xl p-3 shadow-sm text-center">
                    <p class="text-xs text-gray-500">ì—°ì† ì ˆì£¼</p>
                    <p class="text-2xl font-bold text-emerald-600" th:text="${stats.currentStreak + 'ì¼'}">0ì¼</p>
                    <p class="text-xs text-gray-400 mt-1" th:text="'ìµœì¥ ' + ${stats.longestStreak} + 'ì¼'">ìµœì¥ 0ì¼</p>
                </div>
            </div>
        </section>

        <!-- ì£¼ê°„ ì°¨íŠ¸ -->
        <section class="px-4 mb-4">
            <div class="bg-white rounded-2xl shadow-sm p-4">
                <h3 class="text-base font-semibold text-gray-800 mb-4">ì£¼ê°„ ìŒì£¼ í˜„í™©</h3>
                <canvas id="weeklyChart" height="200"></canvas>
            </div>
        </section>

        <!-- ì›”ê°„ ì°¨íŠ¸ -->
        <section class="px-4 mb-4">
            <div class="bg-white rounded-2xl shadow-sm p-4">
                <h3 class="text-base font-semibold text-gray-800 mb-4">ì›”ê°„ ì¶”ì´</h3>
                <canvas id="monthlyChart" height="200"></canvas>
            </div>
        </section>
    </div>

    <!-- ë°ì´í„° ì—†ëŠ” ê²½ìš° -->
    <div th:unless="${hasData}" class="px-4">
        <div class="bg-white rounded-2xl shadow-sm p-8 text-center">
            <span class="text-5xl">ğŸ“Š</span>
            <p class="text-gray-500 mt-4 mb-2">ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”</p>
            <p class="text-sm text-gray-400 mb-6">ì˜¤ëŠ˜ë¶€í„° ì‹œì‘í•´ë³¼ê¹Œìš”?</p>
            <a href="/"
               class="inline-block px-6 py-3 bg-emerald-500 text-white rounded-xl font-medium hover:bg-emerald-600 transition">
                ì²´í¬ì¸ í•˜ëŸ¬ ê°€ê¸°
            </a>
        </div>
    </div>
</main>

<th:block layout:fragment="scripts">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script th:if="${hasData}" th:inline="javascript">
    var weeklyStats = /*[[${weeklyStats}]]*/ [];
    var monthlyStats = /*[[${monthlyStats}]]*/ [];

    // ì£¼ê°„ ì°¨íŠ¸
    new Chart(document.getElementById('weeklyChart'), {
        type: 'bar',
        data: {
            labels: weeklyStats.map(function(d) { return d.weekLabel; }),
            datasets: [{
                label: 'ê¸ˆì£¼',
                data: weeklyStats.map(function(d) { return d.soberDays; }),
                backgroundColor: '#10B981',
                borderRadius: 4
            }, {
                label: 'ìŒì£¼',
                data: weeklyStats.map(function(d) { return d.drinkingDays; }),
                backgroundColor: '#FB923C',
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { position: 'bottom', labels: { boxWidth: 12 } } },
            scales: {
                x: { stacked: true },
                y: { stacked: true, beginAtZero: true, max: 7, ticks: { stepSize: 1 } }
            }
        }
    });

    // ì›”ê°„ ì°¨íŠ¸
    new Chart(document.getElementById('monthlyChart'), {
        type: 'bar',
        data: {
            labels: monthlyStats.map(function(d) { return d.monthLabel; }),
            datasets: [{
                label: 'ê¸ˆì£¼',
                data: monthlyStats.map(function(d) { return d.soberDays; }),
                backgroundColor: '#10B981',
                borderRadius: 4
            }, {
                label: 'ìŒì£¼',
                data: monthlyStats.map(function(d) { return d.drinkingDays; }),
                backgroundColor: '#FB923C',
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { position: 'bottom', labels: { boxWidth: 12 } } },
            scales: {
                x: { stacked: true },
                y: { stacked: true, beginAtZero: true, ticks: { stepSize: 5 } }
            }
        }
    });
</script>
</th:block>
</body>
</html>
