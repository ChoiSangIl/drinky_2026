<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="detail" id="day-detail-content">
    <div class="text-center">
        <p class="text-lg font-semibold text-gray-800"
           th:text="${#temporals.format(date, 'yyyy년 M월 d일')}">2026년 2월 19일</p>

        <!-- 현재 기록 표시 -->
        <div class="my-6">
            <div th:if="${checkIn != null && checkIn.isSober}">
                <span class="text-5xl">⭕</span>
                <p class="text-emerald-600 font-medium mt-2">금주</p>
            </div>
            <div th:if="${checkIn != null && !checkIn.isSober}">
                <span class="text-5xl">❌</span>
                <p class="text-gray-500 font-medium mt-2">음주</p>
            </div>
            <div th:if="${checkIn == null}">
                <span class="text-3xl text-gray-300">-</span>
                <p class="text-gray-400 mt-2">기록 없음</p>
            </div>
        </div>

        <!-- 수정 성공 메시지 -->
        <div th:if="${message}" class="mb-4 py-2 px-4 bg-emerald-50 rounded-lg">
            <p class="text-sm text-emerald-600" th:text="${message}">수정 완료</p>
        </div>

        <!-- 수정 가능한 경우 -->
        <div th:if="${editable}" x-data="{ showConfirm: false, newValue: null }">
            <p class="text-sm text-gray-500 mb-3"
               th:text="${checkIn != null ? '기록을 수정할 수 있어요' : '기록을 추가할 수 있어요'}">수정 가능</p>
            <div class="flex justify-center gap-4 mb-4">
                <button @click="newValue = true; showConfirm = true"
                        :class="newValue === true ? 'ring-2 ring-emerald-500 scale-110' : ''"
                        class="w-16 h-16 rounded-full bg-emerald-100 hover:bg-emerald-200 flex items-center justify-center transition-all active:scale-95 touch-manipulation">
                    <span class="text-2xl">⭕</span>
                </button>
                <button @click="newValue = false; showConfirm = true"
                        :class="newValue === false ? 'ring-2 ring-gray-500 scale-110' : ''"
                        class="w-16 h-16 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-all active:scale-95 touch-manipulation">
                    <span class="text-2xl">❌</span>
                </button>
            </div>

            <!-- 확인 다이얼로그 -->
            <div x-show="showConfirm" x-cloak
                 class="mt-4 p-4 bg-gray-50 rounded-xl">
                <p class="text-sm text-gray-700 mb-3">
                    <span x-show="newValue === true">⭕ <strong>금주</strong></span>
                    <span x-show="newValue === false">❌ <strong>음주</strong></span>
                    로 기록할까요?
                </p>
                <div class="flex gap-3">
                    <button @click="showConfirm = false"
                            class="flex-1 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-100 transition">
                        취소
                    </button>
                    <button th:data-url="@{/checkin/{date}(date=${date})}"
                            @click="
                        htmx.ajax('POST', $el.getAttribute('data-url'), {
                            target: '#day-detail-content',
                            swap: 'outerHTML',
                            values: { isSober: newValue }
                        });
                    "
                            class="flex-1 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition">
                        확인
                    </button>
                </div>
            </div>
        </div>

        <!-- 수정 불가능한 경우 -->
        <div th:if="${!editable}" class="mt-2">
            <p class="text-sm text-gray-400">7일이 지나 수정할 수 없어요</p>
        </div>
    </div>
</div>
</html>
