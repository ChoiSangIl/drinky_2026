# Story 1.3: 인증 UI 및 온보딩 화면

## Status

**Ready for Review**

---

## Story

**As a** 신규 사용자,
**I want** 간단하고 친근한 온보딩 화면을 통해 가입할 수 있어서,
**so that** 앱 사용을 빠르게 시작할 수 있다.

---

## Acceptance Criteria

1. 온보딩 화면 - 앱 소개 (1-2 슬라이드)
2. 로그인/회원가입 선택 화면
3. 이메일 회원가입 폼 (이메일, 비밀번호, 닉네임) - *MVP에서 제외, 소셜 로그인만*
4. 이메일 로그인 폼 - *MVP에서 제외, 소셜 로그인만*
5. 소셜 로그인 버튼 (Google, Kakao)
6. 로그인 성공 시 메인 대시보드로 이동
7. 비로그인 사용자 접근 시 온보딩으로 리다이렉트
8. 모바일 반응형 UI (375px 기준)

---

## Tasks / Subtasks

- [x] **Task 1: 레이아웃 템플릿 구성** (AC: 8)
  - [x] `templates/layout/base.html` - Story 1.1에서 이미 생성됨
    - [x] `<head>` 공통 요소 (meta, TailwindCSS, HTMX, Alpine.js)
    - [x] 모바일 viewport 메타 태그
  - [x] `templates/layout/auth-base.html` 생성 (인증 페이지용 레이아웃, HTMX 제외)
  - [x] 모바일 퍼스트 반응형 스타일 적용 (max-w-md, max-w-xs)

- [x] **Task 2: 온보딩 화면 구현** (AC: 1)
  - [x] `templates/pages/onboarding.html` 생성
  - [x] 슬라이드 1: 앱 소개 ("Drinky - 더 오래, 더 함께")
  - [x] 슬라이드 2: 기능 소개 (원터치 체크인, 스트릭, 통계)
  - [x] Alpine.js로 슬라이드 전환 구현
  - [x] "시작하기" 버튼 + "건너뛰기" 링크 → 로그인 화면 이동

- [x] **Task 3: 로그인 화면 구현** (AC: 2, 5)
  - [x] `templates/pages/login.html` 개선
  - [x] 앱 로고 (이모지 사용) + 환영 메시지
  - [x] Google 로그인 버튼 (SVG 아이콘, 브랜드 컬러)
  - [x] Kakao 로그인 버튼 (SVG 아이콘, #FEE500)
  - [x] 버튼 hover/active 상태 스타일링, min-h-[44px] 터치 타겟

- [x] **Task 4: AuthController 구현** (AC: 6, 7)
  - [x] `AuthController.kt` 생성
  - [x] `GET /login` - 로그인 페이지 (인증 시 `/`로 리다이렉트)
  - [x] `GET /onboarding` - 온보딩 페이지 (인증 시 `/`로 리다이렉트)
  - [x] HomeController에서 `/login` 매핑 제거

- [x] **Task 5: 로그인 성공 핸들러** (AC: 6)
  - [x] `OAuth2SuccessHandler.kt` 수정 - defaultTargetUrl을 `/`로 변경
  - [x] 기존 사용자/신규 사용자 모두 메인(`/`)으로 이동

- [x] **Task 6: 인증 리다이렉트 설정** (AC: 7)
  - [x] `SecurityConfig.kt`에 `/onboarding` 공개 경로 추가
  - [x] 미인증 시 `/login`으로 리다이렉트 (oauth2Login.loginPage)
  - [x] 로그인 후 원래 요청 페이지로 복귀 (isAlwaysUseDefaultTargetUrl=false)

- [x] **Task 7: 에러 처리 화면** (AC: 2)
  - [x] 로그인 실패 시 에러 메시지 표시 (`?error` 파라미터)
  - [x] 로그아웃 메시지 표시 (`?logout` 파라미터)
  - [x] 친근한 에러 메시지 스타일링 (bg-red-50, bg-gray-100)

- [x] **Task 8: 반응형 UI** (AC: 8)
  - [x] 모바일 퍼스트 설계 (max-w-xs 버튼, px-6 패딩)
  - [x] 터치 타겟 min-h-[44px] 적용
  - [ ] 실제 디바이스 테스트 - *수동 검증 필요*

---

## Dev Notes

### 프로젝트 구조 (이 스토리 관련)

```
src/main/kotlin/com/drinky/
├── controller/
│   └── AuthController.kt
└── security/
    └── OAuth2SuccessHandler.kt

src/main/resources/templates/
├── layout/
│   ├── base.html
│   └── auth-base.html
├── pages/
│   ├── onboarding.html
│   └── login.html
└── fragments/
    └── social-buttons.html
```

### base.html 레이아웃 예시

```html
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#10B981">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" th:href="@{/css/output.css}">
    <script src="/js/htmx.min.js" defer></script>
    <script src="/js/alpine.min.js" defer></script>
    <title layout:title-pattern="$CONTENT_TITLE - Drinky">Drinky</title>
</head>
<body class="bg-gray-50 min-h-screen">
    <main layout:fragment="content">
        <!-- 페이지 콘텐츠 -->
    </main>
</body>
</html>
```

### 로그인 페이지 UI 예시

```html
<div class="min-h-screen flex flex-col items-center justify-center px-4">
    <!-- 로고 -->
    <div class="mb-8">
        <img src="/icons/logo.svg" alt="Drinky" class="w-24 h-24">
        <h1 class="text-2xl font-bold text-gray-800 mt-4">Drinky</h1>
        <p class="text-gray-500">더 오래, 더 함께</p>
    </div>

    <!-- 소셜 로그인 버튼 -->
    <div class="w-full max-w-xs space-y-3">
        <a href="/oauth2/authorization/google"
           class="flex items-center justify-center w-full py-3 px-4 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50">
            <img src="/icons/google.svg" class="w-5 h-5 mr-3">
            <span class="text-gray-700">Google로 계속하기</span>
        </a>

        <a href="/oauth2/authorization/kakao"
           class="flex items-center justify-center w-full py-3 px-4 bg-[#FEE500] rounded-lg hover:bg-[#FDD800]">
            <img src="/icons/kakao.svg" class="w-5 h-5 mr-3">
            <span class="text-[#191919]">카카오로 계속하기</span>
        </a>
    </div>
</div>
```

### AuthController 예시

```kotlin
@Controller
class AuthController {

    @GetMapping("/login")
    fun loginPage(authentication: Authentication?): String {
        // 이미 로그인된 경우 대시보드로 리다이렉트
        if (authentication != null && authentication.isAuthenticated) {
            return "redirect:/"
        }
        return "pages/login"
    }

    @GetMapping("/onboarding")
    fun onboardingPage(): String {
        return "pages/onboarding"
    }
}
```

### 브랜딩 컬러

| 용도 | 색상 | HEX |
|------|------|-----|
| Primary (민트/그린) | Emerald 500 | `#10B981` |
| Primary Dark | Emerald 600 | `#059669` |
| Accent (코랄) | Orange 400 | `#FB923C` |
| Background | Gray 50 | `#F9FAFB` |
| Text | Gray 800 | `#1F2937` |
| Text Secondary | Gray 500 | `#6B7280` |

---

## Testing

### 테스트 파일 위치
- `src/test/kotlin/com/drinky/controller/`

### 이 스토리의 테스트 요구사항

| 테스트 파일 | 테스트 내용 |
|------------|------------|
| `AuthControllerTest.kt` | 로그인/온보딩 페이지 렌더링 테스트 |
| `SecurityConfigTest.kt` | 미인증 사용자 리다이렉트 테스트 |

### 테스트 예시

```kotlin
@WebMvcTest(AuthController::class)
class AuthControllerTest {

    @Autowired
    private lateinit var mockMvc: MockMvc

    @Test
    fun `로그인 페이지 접근 성공`() {
        mockMvc.perform(get("/login"))
            .andExpect(status().isOk)
            .andExpect(view().name("pages/login"))
    }

    @Test
    @WithMockUser
    fun `이미 로그인된 사용자는 대시보드로 리다이렉트`() {
        mockMvc.perform(get("/login"))
            .andExpect(status().is3xxRedirection)
            .andExpect(redirectedUrl("/"))
    }
}
```

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-24 | 0.1 | 스토리 초안 작성 | PO Sarah |
| 2026-02-02 | 0.2 | 전체 구현 완료 (온보딩, 로그인 UI, AuthController, 테스트) | Dev James |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
*(개발 중 생성된 디버그 로그 참조)*

### Completion Notes List
- **Task 1**: `auth-base.html` 신규 생성. 인증 페이지 전용 레이아웃 (HTMX 불필요). `base.html`은 Story 1.1에서 이미 존재.
- **Task 2**: 이모지로 로고 대체 (별도 아이콘 파일 없음). Alpine.js x-show/x-transition으로 슬라이드 구현.
- **Task 3**: Google/Kakao 로고를 inline SVG로 구현 (외부 파일 의존성 제거).
- **Task 4**: HomeController에서 `/login` 분리하여 AuthController로 이동. 인증된 사용자 리다이렉트 로직 추가.
- **Task 5**: `defaultTargetUrl`을 `/dashboard` → `/`로 변경 (대시보드는 아직 미구현).
- **Task 8**: 실제 디바이스 테스트는 수동 검증 필요.

### File List
**신규 생성:**
- `src/main/resources/templates/layout/auth-base.html` - 인증 페이지용 레이아웃
- `src/main/resources/templates/pages/onboarding.html` - 온보딩 화면 (2 슬라이드)
- `src/main/kotlin/com/drinky/controller/AuthController.kt` - 인증 관련 컨트롤러
- `src/test/kotlin/com/drinky/controller/AuthControllerTest.kt` - AuthController 테스트

**수정:**
- `src/main/resources/templates/pages/login.html` - 브랜드 아이콘, 스타일 개선
- `src/main/kotlin/com/drinky/controller/HomeController.kt` - `/login` 매핑 제거
- `src/main/kotlin/com/drinky/security/OAuth2SuccessHandler.kt` - defaultTargetUrl → `/`
- `src/main/kotlin/com/drinky/config/SecurityConfig.kt` - `/onboarding` 공개 경로 추가

---

## QA Results
*(QA 에이전트의 리뷰 결과)*
