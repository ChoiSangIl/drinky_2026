# Story 1.1: 프로젝트 기반 구축 및 로컬 개발 환경 설정

## Status

**Ready for Review**

---

## Story

**As a** 개발자,
**I want** 프로젝트 기반 구조와 로컬 개발 환경을 구축하여,
**so that** 이후 모든 기능을 로컬에서 안정적으로 개발하고 테스트할 수 있다.

---

## Acceptance Criteria

1. Spring Boot + Kotlin + Gradle 프로젝트 초기화
2. Thymeleaf + HTMX + Alpine.js 프론트엔드 설정 완료
3. TailwindCSS 설정 완료 (frontend 빌드 스크립트 포함)
4. PostgreSQL 로컬 데이터베이스 생성 및 연결 확인
5. 헬스체크 페이지("/health") 로컬 접속 확인 (localhost:8080)
6. dev 프로파일 기반 로컬 실행 환경 정상 동작 확인

> **Note:** CI/CD 파이프라인(GitHub Actions), 서버 배포(systemd, Nginx) 설정은 개발 완료 후 별도 배포 단계에서 진행합니다.

---

## Tasks / Subtasks

- [x] **Task 1: Spring Boot 프로젝트 초기화** (AC: 1)
  - [x] Spring Initializr로 프로젝트 생성 (Kotlin, Gradle, Spring Boot 3.2.x)
  - [x] 필수 의존성 추가: Spring Web, Spring Data JPA, Thymeleaf, PostgreSQL Driver, Spring Security
  - [x] `DrinkyApplication.kt` 메인 클래스 확인
  - [x] `application.yml` 기본 설정 (dev/prod 프로파일 분리)

- [x] **Task 2: 프론트엔드 통합 설정** (AC: 2, 3)
  - [x] Thymeleaf 레이아웃 구조 설정 (`templates/layout/base.html`)
  - [x] HTMX 1.9.x CDN 또는 로컬 파일 추가 (`static/js/htmx.min.js`)
  - [x] Alpine.js 3.x CDN 또는 로컬 파일 추가 (`static/js/alpine.min.js`)
  - [x] TailwindCSS 설정 (`frontend/` 디렉토리)
    - [x] `package.json` 생성
    - [x] `tailwind.config.js` 설정
    - [x] `src/input.css` 작성
    - [x] 빌드 스크립트 추가 (`npm run build:css`)
  - [x] TailwindCSS 빌드 결과물 (`static/css/output.css`) 연동

- [x] **Task 3: 데이터베이스 설정** (AC: 4) - *local: H2, dev/prod: PostgreSQL*
  - [x] ~~PostgreSQL 로컬 설치~~ → `local` 프로파일에서 H2 인메모리 DB 사용
  - [x] ~~`drinky_db` 데이터베이스 생성~~ → H2 자동 생성 (`drinky_local`)
  - [x] ~~`drinky` 사용자 생성 및 권한 부여~~ → H2 기본 사용자 (`sa`)
  - [x] `application-local.yml` 생성 (H2 인메모리 DB 설정)
  - [x] `application-dev.yml` PostgreSQL 설정 유지
  - [x] JPA/Hibernate 설정 (local: create-drop, dev: validate)
  - [x] Flyway 비활성화 (local), 활성화 (dev/prod)

- [x] **Task 4: 헬스체크 엔드포인트 구현** (AC: 7)
  - [x] `HomeController.kt` 생성
  - [x] `GET /health` 엔드포인트 구현 (JSON 또는 HTML 응답)
  - [x] 로컬에서 테스트 확인

- [x] **Task 5: 로컬 실행 검증** (AC: 5, 6)
  - [x] `./gradlew bootRun` 으로 로컬 실행 확인 (local 프로파일, H2)
  - [x] `http://localhost:8080/health` 접속 확인 (200 OK, JSON 응답)
  - [x] local 프로파일 정상 동작 확인 (Thymeleaf 캐싱 OFF, DEBUG 로깅)

> **배포 관련 태스크 (개발 완료 후 진행 예정):**
> - GitHub Actions CI/CD 파이프라인 구성 (`.github/workflows/deploy.yml` 스크립트 작성 완료)
> - 서버 인프라 설정: systemd, Nginx, SSL (`scripts/server-setup.sh`, `scripts/nginx-setup.sh` 스크립트 작성 완료)
> - GitHub Secrets 설정, 서버 배포 검증

---

## Dev Notes

### 프로젝트 구조 (Source Tree)

```
drinky/
├── .github/
│   └── workflows/
│       └── deploy.yml
├── src/
│   ├── main/
│   │   ├── kotlin/
│   │   │   └── com/drinky/
│   │   │       ├── DrinkyApplication.kt
│   │   │       ├── config/
│   │   │       │   └── WebConfig.kt
│   │   │       └── controller/
│   │   │           └── HomeController.kt
│   │   └── resources/
│   │       ├── application.yml
│   │       ├── application-dev.yml
│   │       ├── application-prod.yml
│   │       ├── templates/
│   │       │   ├── layout/
│   │       │   │   └── base.html
│   │       │   └── pages/
│   │       │       └── health.html
│   │       └── static/
│   │           ├── css/
│   │           │   └── output.css
│   │           └── js/
│   │               ├── htmx.min.js
│   │               └── alpine.min.js
│   └── test/
│       └── kotlin/
│           └── com/drinky/
├── frontend/
│   ├── package.json
│   ├── tailwind.config.js
│   └── src/
│       └── input.css
├── scripts/
│   └── deploy.sh
├── build.gradle.kts
├── settings.gradle.kts
└── .env.example
```

### 기술 스택 버전

| 기술 | 버전 |
|------|------|
| Kotlin | 1.9.22 |
| JVM (Corretto) | 21 LTS |
| Spring Boot | 3.2.2 |
| Thymeleaf | 3.1.2 |
| HTMX | 1.9.10 |
| Alpine.js | 3.13.3 |
| TailwindCSS | 3.4.1 |
| Gradle | 8.5 |
| PostgreSQL | 16.x |

### Nginx 설정 예시

```nginx
server {
    listen 80;
    server_name xxx.iptime.org;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name xxx.iptime.org;

    ssl_certificate /etc/letsencrypt/live/xxx.iptime.org/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/xxx.iptime.org/privkey.pem;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### systemd 서비스 예시

```ini
[Unit]
Description=Drinky Application
After=syslog.target network.target postgresql.service

[Service]
Type=simple
User=drinky
WorkingDirectory=/opt/drinky/app
EnvironmentFile=/opt/drinky/.env.prod
ExecStart=/usr/bin/java -Xms256m -Xmx512m -Dspring.profiles.active=prod -jar drinky.jar
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

### 환경 변수 (.env.example)

```bash
# Database
DATABASE_URL=jdbc:postgresql://localhost:5432/drinky_db
DATABASE_USERNAME=drinky
DATABASE_PASSWORD=your_password

# App
APP_BASE_URL=https://xxx.iptime.org
SPRING_PROFILES_ACTIVE=prod
```

---

## Testing

### 테스트 파일 위치
- `src/test/kotlin/com/drinky/`

### 테스트 표준
- **Framework:** JUnit 5 (5.10.1)
- **Mocking:** MockK (1.13.9)
- **Assertion:** AssertJ (3.25.1)
- **파일 명명 규칙:** `{ClassName}Test.kt`

### 이 스토리의 테스트 요구사항
- `HomeControllerTest.kt`: `/health` 엔드포인트 응답 테스트
- 통합 테스트: DB 연결 확인

### 테스트 실행 명령어

```bash
# 전체 테스트
./gradlew test

# 특정 테스트
./gradlew test --tests "HomeControllerTest"
```

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-24 | 0.1 | 스토리 초안 작성 | PO Sarah |
| 2026-02-02 | 0.2 | Task 3: local 프로파일 H2 전환, Task 5: 로컬 실행 검증 완료 | Dev James |

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References

*(개발 중 생성된 디버그 로그 참조)*

### Completion Notes List

- **Task 1**: Java 17 사용 (아키텍처는 21 명시, 로컬 환경 제약으로 17 사용)
- **Task 3**: `local` 프로파일 신설 (H2 인메모리 DB, H2 콘솔 `/h2-console`). `dev`는 PostgreSQL 유지. 기본 활성 프로파일을 `local`로 변경. SecurityConfig에 H2 콘솔 접근 허용 추가.
- **Task 5 (변경)**: 배포 관련 태스크(CI/CD, 서버 인프라)는 개발 완료 후 별도 진행 예정. 배포 스크립트(deploy.yml, server-setup.sh, nginx-setup.sh)는 작성 완료 상태로 보관.

### File List

**Task 1에서 생성된 파일:**
- `build.gradle.kts` - Gradle 빌드 설정
- `settings.gradle.kts` - Gradle 설정
- `gradle.properties` - Gradle 속성
- `gradlew` - Unix Gradle wrapper
- `gradlew.bat` - Windows Gradle wrapper
- `gradle/wrapper/gradle-wrapper.properties` - Wrapper 설정
- `gradle/wrapper/gradle-wrapper.jar` - Wrapper JAR
- `src/main/kotlin/com/drinky/DrinkyApplication.kt` - 메인 애플리케이션
- `src/main/kotlin/com/drinky/config/WebConfig.kt` - 웹 설정
- `src/main/kotlin/com/drinky/config/SecurityConfig.kt` - 보안 설정
- `src/main/resources/application.yml` - 공통 설정
- `src/main/resources/application-dev.yml` - 개발 환경 설정
- `src/main/resources/application-prod.yml` - 운영 환경 설정
- `src/test/kotlin/com/drinky/DrinkyApplicationTests.kt` - 컨텍스트 로드 테스트
- `src/test/resources/application-test.yml` - 테스트 환경 설정
- `.env.example` - 환경 변수 예시
- `.gitignore` - Git 무시 파일

**Task 2에서 생성된 파일:**
- `src/main/resources/templates/layout/base.html` - Thymeleaf 기본 레이아웃
- `src/main/resources/static/js/htmx.min.js` - HTMX 1.9.10
- `src/main/resources/static/js/alpine.min.js` - Alpine.js 3.13.3
- `src/main/resources/static/css/output.css` - TailwindCSS 빌드 결과
- `frontend/package.json` - npm 패키지 설정
- `frontend/tailwind.config.js` - TailwindCSS 설정
- `frontend/src/input.css` - TailwindCSS 입력 파일

**Task 3에서 생성/수정된 파일:**
- `scripts/db-setup.sql` - PostgreSQL 데이터베이스 설정 SQL (dev/prod용)
- `scripts/db-setup.ps1` - Windows PowerShell 설정 스크립트 (dev/prod용)
- `src/main/resources/db/migration/V1__init_schema.sql` - Flyway 초기 스키마 (dev/prod용)
- `src/main/resources/application-local.yml` - (신규) local 프로파일, H2 인메모리 DB
- `src/main/resources/application.yml` - (수정) 기본 프로파일 dev→local 변경
- `build.gradle.kts` - (수정) H2 runtimeOnly 의존성 추가
- `src/main/kotlin/com/drinky/config/SecurityConfig.kt` - (수정) H2 콘솔 접근 허용
- `src/test/resources/application-test.yml` - Flyway 비활성화

**Task 4에서 생성된 파일:**
- `src/main/kotlin/com/drinky/controller/HomeController.kt` - 홈/헬스체크 컨트롤러
- `src/main/resources/templates/pages/home.html` - 홈 페이지 템플릿
- `src/test/kotlin/com/drinky/controller/HomeControllerTest.kt` - 컨트롤러 테스트

**배포 관련 파일 (개발 완료 후 사용 예정):**
- `.github/workflows/deploy.yml` - GitHub Actions CI/CD 워크플로우
- `scripts/deploy.sh` - 수동 배포 스크립트
- `scripts/server-setup.sh` - 서버 초기 설정 스크립트 (systemd 포함)
- `scripts/nginx-setup.sh` - Nginx 설정 스크립트
- `frontend/package-lock.json` - npm 락 파일

---

## QA Results

*(QA 에이전트의 리뷰 결과)*
